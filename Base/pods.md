Links: [[Kubernetes]]

### Запуск под:
1. Подготовка и валидация runtime-объекта
2. Идентификация и авторизация запроса
3. Обработка запроса [[admission controlers]]
4. Сохранение ресурса в [[etcd]]
5. Основной цикл обработки ресурсов ([[deployment controller]])
6. Запуск планировщика
7. Магия [[kubelet]]
8. Магия runtime. Подготовка изолированного окружения
9. Магия runtime. Инициализация сети
10. Магия runtime. Запуск контейнеров
11. [[kubelet]] Запуск хуков

### Авторизация
После регистрации пользователя на [[kube-apiserver]] запрос проходит через цепочку authorizers (RBAC, ABAC, Node)
1. Достаточно первого ответа (можно/нельзя)
2. Если один из авторизаторов не ответил внятно, запрос отклоняется.

Далее вызывается [[admission controlers]] которые смотрят на параметры runtime-объекта. 
1. Можно/Нельзя [[podSecurityPolicy]]
2. Меняют параметры объекта [[alwaysPullImages]]
3. Создают новые объекты [[NamespaceAutoProvision]]

### Планирование ресурсов
1. Допущенные к запуску и полностью мутировавшие Поды попадают в очередь планировщика
2. Планирвщик kube-scheduler сортирует очередь
3. После сортировки планировщик выбирает поды, подходящие для запуска и делает оценку пригодности
4. Происходит binding - связывание пода и узла [[node]]. Сохраниение объекта под в [[etcd]]

### Что делает [[kubelet]]
1. [[kubelet]]  опршивает [[kube-apiserver]] и забирает список подов со своим [[node name]]
2. [[kubelet]] сверяет список полученных подов со списком запущенных
3.  [[kubelet]] удаляет и создает поды, чтобы достичь соответствия между опианных и текущим состоянием
4. [[node authorizer]] ограничивает права [[kubelet]] объектами связанными с его подами
5. [[kubelet]] регистрирует базовые метрики связанные с подами (например тайминги запуска)
6. [[kubelet]] выполняет дополнительные проверки [[admission handlers]] для полученного пода

###  [[kubelet]] [[admission handlers]] [[podSyncHandlers]]

1. Проверка [[pods]] на совместимость с текущей версией и конфигурацией runtime
	 - [[noNewPrivileges]], [[sysctl]], [[appArmor]]/[[SELinux]]
2. Доступные ресурсы
	- Для подов с гарантированными ресурсами всегда "зеленый свет" (ресурсы освобождаются потом)
3. Также [[kubelet]] делает переодические проверки запущенных подов (начиная с момента запуска) 
	- Например, проверка соответствия [[ActiveDeadline]] для [[Jobs]]
	- [[pods]] не прошедшие проверку идут на eviction
	
[[pods]] которые прошли [[server Dry-Run]], [[admission controlers]] и [[планировщик]] не обязательно будут запущены.

### PodStatus | Phase
- Pending - объект был создан и может быть даже, назначена [[node]] для него. Если [[pods]] не прошел [[admission handlers]], он останется в этом состоянии.
- Running - все контейнеры [[pods]] запущены и [[post-start hook]] отработал.
- Succeeded - все контейнеры корректно завершили работту.
- Failed - все контейнеры остановлены, как минимум один контейнер некорректно завершил работу (или не прошел проверки [[podSyncHandlers]])
- Unknown - [[kube-apiserver]] не в курсе, что там с этим подом (обычноб из-за пробдем со связью).